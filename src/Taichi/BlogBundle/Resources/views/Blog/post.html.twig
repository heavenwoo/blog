{% extends 'TaichiBlogBundle::layout.html.twig' %}

{% block body_id 'blog_post_show' %}

{% block heading %}{% endblock %}

{% block content %}
    <h1>{{ post.subject }}</h1>
    <div class="text-muted">
        <i class="fa fa-calendar small"></i> {{ post.createdAt|date("F jS \\@ G:i") }}
        <i class="fa fa-folder small"></i> <a
                href="{{ path('blog_category', {name: post.category.name}) }}">{{ post.category.name }}</a>
        {% for tag in post.tags %}
            <i class="fa fa-tag small"></i> <a href="{{ path('blog_tag', {name: tag.name}) }}"
                                               class="href">{{ tag.name }}</a>
        {% endfor %}
    </div>

    <p>{{ post.content|markdown }}</p>

    <div id="post-add-comment" class="well">
        {# The 'IS_AUTHENTICATED_FULLY' role ensures that the user has entered
        his/her credentials (login + password) during this session. If he/she
        is automatically logged via the 'Remember Me' functionality, he/she won't
        be able to add a comment.
        See http://symfony.com/doc/current/cookbook/security/remember_me.html#forcing-the-user-to-re-authenticate-before-accessing-certain-resources
        #}
        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
            {{ render(controller('TaichiBlogBundle:Blog:commentForm', { 'id': post.id })) }}
        {% else %}
            <p>
                <a class="btn btn-success" href="{{ path('security_login_form') }}">
                    <i class="fa fa-sign-in"></i> Sign in
                </a>
                to leave a comment.
            </p>
        {% endif %}
    </div>

    <h3>{{ post.comments|length }} comments: </h3>
    {% for comment in post.comments %}
        <div class="row post-comment">
            <h4 class="col-sm-3">
                <strong>{{ comment.user.username }}</strong>
                <strong>{{ comment.createdAt|date("Y-m-d") }}</strong>
            </h4>
            <div class="col-sm-9">
                {{ comment.content|markdown }}
            </div>
        </div>
    {% else %}
        <div class="post-comment">
            <p>No comment.</p>
        </div>
    {% endfor %}
{% endblock %}