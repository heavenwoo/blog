{% extends 'TaichiBlogBundle::layout.html.twig' %}

{% block heading %}
    <h1 class="ui inverted header">
        {{ post.subject }}
    </h1>
    <div class="ui horizontal post-meta post-show">
        <i class="calendar icon"></i> <span class="item">{{ post.createdAt(locale).diffForHumans }}</span>
        <i class="folder outline icon"></i> <a
                class="item" href="{{ path('blog_category', {name: post.category.name}) }}">{{ post.category.name }}</a>
        {% for tag in post.tags %}
            <i class="tag icon"></i> <a
                class="item" href="{{ path('blog_tag', {name: tag.name}) }}">{{ tag.name }}</a>
        {% endfor %}
    </div>
{% endblock %}

{% block content %}
    {{ post.content|markdown }}

    <div class="ui comments">
        <h3 class="ui dividing header">{{ 'post.num_comments'|transchoice(post.comments|length) }}</h3>
        {% for comment in post.comments %}
            <div class="comment">
                <a class="avatar">
                    {% image '@TaichiBlogBundle/Resources/public/images/avatar/elliot.jpg' %}
                    <img src="{{ asset_url }}">
                    {% endimage %}
                </a>
                <div class="content">
                    <a class="author">{{ comment.user.username }}</a>
                    <div class="metadata">
                        {{ 'post.commented_on'|trans }} <span class="date">{{ comment.createdAt(locale).diffForHumans }}</span>
                    </div>
                    <div class="text">{{ comment.content|markdown }}</div>
                    <div class="actions">
                        <a class="reply">Reply</a>
                        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
                        <a class="error">delete</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}

        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
            {{ render(controller('TaichiBlogBundle:Blog:commentForm', { 'id': post.id })) }}
        {% else %}
            <form class="ui reply form">
                <a class="ui button" href="{{ path('security_login_form') }}">
                    <i class="sign-in icon"></i> Sign in
                </a>
                to leave a comment.
            </form>
        {% endif %}
    </div>
    <div id="disqus_thread"></div>
    <script>
        /**
         * RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
         * LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
         */

         var disqus_config = function () {
         this.page.url = {{ path('blog_post', {id: post.id}) }}; // Replace PAGE_URL with your page's canonical URL variable
         this.page.identifier = "post-" + {{ post.id }}; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
         };

        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//heavenwoo.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
{% endblock %}