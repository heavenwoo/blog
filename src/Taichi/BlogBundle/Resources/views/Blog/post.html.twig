{% extends 'TaichiBlogBundle::layout.html.twig' %}

{% block heading %}
    <h1 class="ui inverted header">
        {{ post.subject }}
    </h1>
    <div class="ui horizontal post-meta post-show">
        <i class="calendar icon"></i> <span class="item">{{ post.createdAt|date("Y-m-d G:i") }}</span>
        <i class="folder outline icon"></i> <a
                class="item" href="{{ path('blog_category', {name: post.category.name}) }}">{{ post.category.name }}</a>
        {% for tag in post.tags %}
            <i class="tag icon"></i> <a
                class="item" href="{{ path('blog_tag', {name: tag.name}) }}">{{ tag.name }}</a>
        {% endfor %}
    </div>
{% endblock %}

{% block content %}
    {{ post.content|markdown }}

    <div class="ui comments">
        <h3 class="ui dividing header">{{ post.comments|length }} comments: </h3>
    {% for comment in post.comments %}
        <div class="comment">
            <a class="avatar">
                {% image '@TaichiBlogBundle/Resources/public/img/avatar/elliot.jpg' %}
                <img src="{{ asset_url }}">
                {% endimage %}
            </a>
            <div class="content">
                <a class="author">{{ comment.user.username }}</a>
                <div class="metadata">
                    <span class="date">{{ comment.createdAt|date("Y-m-d") }}</span>
                </div>
                <div class="text">{{ comment.content|markdown }}</div>
                <div class="actions">
                    <a class="reply">Reply</a>
                </div>
            </div>
        </div>
    {% endfor %}

        {% if is_granted('IS_AUTHENTICATED_FULLY') %}
        {{ render(controller('TaichiBlogBundle:Blog:commentForm', { 'id': post.id })) }}
    {% else %}
        <form class="ui reply form">
            <a class="ui button" href="{{ path('security_login_form') }}">
                <i class="sign-in icon"></i> Sign in
            </a>
            to leave a comment.
        </form>
        {% endif %}
    </div>

{% endblock %}